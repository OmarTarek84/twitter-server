(this["webpackJsonptwitter-clone"]=this["webpackJsonptwitter-clone"]||[]).push([[17],{149:function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"b",(function(){return u})),a.d(t,"a",(function(){return l})),a.d(t,"d",(function(){return m}));var s=a(32),n=a.n(s),r=a(43),c=a(44),i=(a(29),a(5)),o=function(e,t,a){return function(){var s=Object(r.a)(n.a.mark((function s(r,o){var u,l,m;return n.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,1===t&&r({type:i.CHAT_LOADING}),u=o().user&&o().user.token?o().user.token:localStorage.getItem("accessToken"),s.next=5,c.a.get("/chat/getMessages?chatId=".concat(e,"&currentPage=").concat(t,"&pageSize=").concat(a),{headers:{Authorization:"Bearer "+u}});case 5:l=s.sent,m=l.data,r({type:i.FETCH_CHAT_MESSAGES,chat:m.chat,messages:m.messages,currentPage:m.currentPage,pages:m.pages,messagesCount:m.messagesCount,pageSize:m.pageSize}),s.next=13;break;case 10:s.prev=10,s.t0=s.catch(0),r({type:i.CHAT_MESSAGES_ERROR,error:s.t0.response&&s.t0.response.data&&s.t0.response.data.message?s.t0.response.data.message:s.t0.message});case 13:case"end":return s.stop()}}),s,null,[[0,10]])})));return function(e,t){return s.apply(this,arguments)}}()},u=function(e,t){return function(){var a=Object(r.a)(n.a.mark((function a(s,r){var o,u,l;return n.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,s({type:i.CHAT_LOADING}),a.next=4,c.a.post("/chat/createChat?isGroupChat=".concat(t),{users:e},{headers:{Authorization:"Bearer "+(r().user.token||localStorage.getItem("accessToken"))}});case 4:return o=a.sent,u=o.data,a.next=8,s({type:i.CREATE_CHAT,chat:u});case 8:return l=a.sent,a.abrupt("return",l);case 12:a.prev=12,a.t0=a.catch(0),console.log(a.t0);case 15:case"end":return a.stop()}}),a,null,[[0,12]])})));return function(e,t){return a.apply(this,arguments)}}()},l=function(e,t){return function(){var a=Object(r.a)(n.a.mark((function a(s,r){return n.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,c.a.put("/chat/changeChatName?chatId=".concat(e),{chatName:t},{headers:{Authorization:"Bearer "+(r().user.token||localStorage.getItem("accessToken"))}});case 3:s({type:i.CHANGE_CHAT_NAME,chatName:t}),a.next=9;break;case 6:a.prev=6,a.t0=a.catch(0),console.log(a.t0);case 9:case"end":return a.stop()}}),a,null,[[0,6]])})));return function(e,t){return a.apply(this,arguments)}}()},m=function(e,t){return function(){var a=Object(r.a)(n.a.mark((function a(s,r){var o;return n.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=(new Date).toISOString(),s({type:i.SEND_MESSAGE,message:{content:t,_id:o,createdAt:new Date,updatedAt:new Date,sender:{coverPhoto:r().user.userDetails.coverPhoto,firstName:r().user.userDetails.firstName,lastName:r().user.userDetails.lastName,profilePic:r().user.userDetails.profilePic,username:r().user.userDetails.username},readBy:[],chat:e,error:!1}}),a.prev=2,a.next=5,c.a.post("/chat/sendMessage?chatId=".concat(e),{content:t},{headers:{Authorization:"Bearer "+(r().user.token||localStorage.getItem("accessToken"))}});case 5:s({type:i.UPDATE_LATEST_MESSAGE,content:t,user:{coverPhoto:r().user.userDetails.coverPhoto,firstName:r().user.userDetails.firstName,lastName:r().user.userDetails.lastName,profilePic:r().user.userDetails.profilePic,username:r().user.userDetails.username},chatId:e}),a.next=12;break;case 8:a.prev=8,a.t0=a.catch(2),console.log(a.t0),s({type:i.SEND_MESSAGE_ERROR,msgId:o});case 12:case"end":return a.stop()}}),a,null,[[2,8]])})));return function(e,t){return a.apply(this,arguments)}}()}},186:function(e,t,a){},187:function(e,t,a){},202:function(e,t,a){"use strict";a.r(t);var s=a(2),n=a(143),r=a(1),c=a(153),i=a(21),o=a(6),u=a(13),l=a(9),m=a(5),h=a(149),d=a(45),p=(a(186),function(e){var t=e.closeChatNameModel,a=e.changeChatname,c=Object(r.useState)(""),i=Object(n.a)(c,2),o=i[0],u=i[1];return Object(s.jsx)("div",{className:"backdrop",children:Object(s.jsxs)("div",{className:"changeChatModal",children:[Object(s.jsxs)("div",{className:"titleP",children:[Object(s.jsx)("h3",{children:"Change The Chat Name"}),Object(s.jsx)("i",{className:"fa fa-times",onClick:t})]}),Object(s.jsx)("div",{className:"changeChatInput",children:Object(s.jsx)("input",{type:"text",name:"chatname",value:o,onChange:function(e){return u(e.target.value)}})}),Object(s.jsxs)("div",{className:"btnActions",children:[Object(s.jsx)("button",{className:"btn btn-primary",onClick:function(){return a(o)},children:"Save"}),Object(s.jsx)("button",{onClick:t,className:"btn btn-danger",children:"Cancel"})]})]})})}),j=(a(187),a(46));t.default=function(){var e=Object(o.g)(),t=Object(i.b)(),a=Object(i.c)((function(e){return e.chat})),g=a.chatError,f=a.chatLoading,b=a.chat,O=a.messages,N=a.currentMessagesPage,x=a.totalMessagesPages,v=Object(i.c)((function(e){return e.user})).userDetails,S=Object(r.useState)(!1),C=Object(n.a)(S,2),E=C[0],y=C[1],A=Object(r.useRef)(),k=Object(r.useRef)(),T=Object(r.useRef)(),I=Object(r.useRef)(),D=Object(j.a)().socket,w=Object(c.a)(),P=w.handleSubmit,_=w.register,M=w.reset,R=function(){y(!0)},H=function(){y(!1)};Object(r.useEffect)((function(){var a=e.pathname.split("/")[2];return a?(D.current.emit("join room",a),t(Object(h.c)(a,1,30)).then((function(){if(A.current&&k.current&&T.current){var e=A.current.getBoundingClientRect().height+k.current.getBoundingClientRect().height+T.current.getBoundingClientRect().height+26;document.querySelector(".messages").style.maxHeight="calc(100vh - ".concat(e,"px)");var t=document.getElementById("sc");t.scrollTop=t.scrollHeight-t.clientHeight-1}}))):l.a.push("/messages"),function(){t({type:m.CLEAR_MESSAGES})}}),[e.pathname,t]);var B=function(e,t,a,n,r,c,i){return Object(s.jsxs)("div",{className:"fl",style:{marginTop:c?"12px":"0"},children:[Object(s.jsx)("div",{className:"image",children:i&&Object(s.jsx)("img",{src:e,alt:n})}),Object(s.jsxs)("div",{className:"content-names",children:[c&&Object(s.jsxs)("span",{className:"firstlastnames",children:[t," ",a]}),Object(s.jsx)("span",{className:"content",children:r})]})]})};return console.log("CHAT RENDERED"),Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("div",{className:"messagechat",children:[Object(s.jsxs)("div",{className:"title",ref:A,children:[Object(s.jsx)("h2",{children:"Chat"}),Object(s.jsx)(u.a,{to:"/messages/new",children:Object(s.jsx)("i",{className:"far fa-plus-square"})})]}),b&&Object(s.jsx)("div",{className:"peoplesChat",ref:k,children:function(){if(b){var e=b.users.filter((function(e){return e.username!==localStorage.getItem("userName")})),t=e.map((function(e){return e.firstName+" "+e.lastName}));return b.isGroupChat&&e[1]?Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("div",{className:"images",children:[Object(s.jsx)("img",{className:"firstImg",src:e[0].profilePic,alt:e[0].username}),Object(s.jsx)("img",{className:"secondImg",src:e[1].profilePic,alt:e[1].username}),e.length>2&&Object(s.jsxs)("span",{className:"usersLeft",children:["+",e.length-2]})]}),Object(s.jsx)("span",{className:"chatname",onClick:R,children:b.chatName?b.chatName:t.join(", ")})]}):Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("div",{className:"image",children:Object(s.jsx)("img",{className:"singleImg",src:e[0].profilePic,alt:e[0].username})}),Object(s.jsx)("span",{className:"chatname",children:e[0].firstName+" "+e[0].lastName})]})}}()}),Object(s.jsx)("div",{className:"messages",ref:I,id:"sc",onScroll:function(){var a=document.getElementById("sc");0===a.scrollTop&&N+1<=x&&t(Object(h.c)(e.pathname.split("/")[2],N+1,30)).then((function(){a.scrollTop=(a.scrollHeight-a.clientHeight)/2}))},children:f?Object(s.jsx)(d.a,{width:"60px"}):g?Object(s.jsx)("h4",{className:"chaterror",children:g}):O.map((function(e,t){var a,n,r=v?v.username:localStorage.getItem("userName"),c=!O[t-1]||O[t-1].sender.username!==O[t].sender.username,i=!O[t+1]||!O[t-1]||O[t-1].sender.username===O[t].sender.username&&O[t+1].sender.username!==O[t].sender.username,o=e.sender.username===r?"own":"theirs";return Object(s.jsx)("div",{className:"msg".concat(t," ").concat(o),children:"own"===o?(a=e.content,n=e.error,Object(s.jsxs)("div",{className:"flCol",children:[Object(s.jsx)("span",{style:{opacity:n?".4":"1"},children:a}),n&&Object(s.jsx)("p",{className:"error",children:"Error Sending this message"})]})):B(e.sender.profilePic,e.sender.firstName,e.sender.lastName,e.sender.username,e.content,c,i)},e._id)}))}),Object(s.jsxs)("form",{className:"submitMsg",ref:T,onSubmit:P((function(a){var s=a.msg;M();var n=document.getElementById("sc");D.current.emit("sendMessage",{sender:{firstName:v.firstName,lastName:v.lastName,profilePic:v.profilePic,username:v.username,email:v.email},content:a.msg,chatId:e.pathname.split("/")[2],createdAt:new Date}),t(Object(h.d)(e.pathname.split("/")[2],s)).then((function(){n.scrollTop=n.scrollHeight-n.clientHeight-1}));var r=b.users.map((function(e){return e.username}));D.current.emit("notification Sent",{notificationFrom:v.username,notificationTo:r,type:"newMessage",chatId:b._id})})),children:[Object(s.jsx)("input",{type:"text",name:"msg",placeholder:"Type a message...",ref:_({required:!0})}),Object(s.jsx)("button",{type:"submit",children:Object(s.jsx)("i",{className:"fas fa-paper-plane"})})]})]}),E&&Object(s.jsx)(p,{closeChatNameModel:H,changeChatname:function(a){H(),t(Object(h.a)(e.pathname.split("/")[2],a))}})]})}}}]);
//# sourceMappingURL=17.386010cf.chunk.js.map