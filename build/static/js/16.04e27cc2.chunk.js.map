{"version":3,"sources":["store/Actions/chat.js","components/MessageChat/ChatNameModel/ChatNameModel.js","components/MessageChat/MessageChat.js"],"names":["getChatMsgs","chatId","currentPage","pageSize","dispatch","getState","a","type","CHAT_LOADING","token","user","localStorage","getItem","axios","get","headers","Authorization","data","FETCH_CHAT_MESSAGES","chat","messages","pages","messagesCount","CHAT_MESSAGES_ERROR","error","response","message","createChat","users","isGroupChat","post","CREATE_CHAT","result","console","log","changeChatName","chatName","put","CHANGE_CHAT_NAME","sendMessage","content","newDate","Date","toISOString","SEND_MESSAGE","_id","createdAt","updatedAt","sender","coverPhoto","userDetails","firstName","lastName","profilePic","username","readBy","socketIOClient","transports","emit","email","UPDATE_LATEST_MESSAGE","SEND_MESSAGE_ERROR","msgId","ChatNameModel","closeChatNameModel","changeChatname","useState","inputVal","setInputVal","className","onClick","name","value","onChange","e","target","MessageChat","location","useLocation","useDispatch","useSelector","state","chatError","chatLoading","currentMessagesPage","totalMessagesPages","openModel","setOpenModel","titleRef","useRef","peoplesRef","formRef","messageChatRef","socket","useForm","handleSubmit","register","reset","openChatNameModel","useEffect","pathname","split","current","then","allElementsHeightAdded","getBoundingClientRect","height","document","querySelector","style","maxHeight","list","getElementById","scrollTop","scrollHeight","clientHeight","history","push","CLEAR_MESSAGES","disconnect","renderTheirsMsg","isFirst","isLast","marginTop","src","alt","ref","to","chatUsers","filter","groupChatNames","map","length","join","renderImageAndNames","id","onScroll","Spinner","width","msg","index","senderClassName","opacity","onSubmit","formData","placeholder","required","val"],"mappings":"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","file":"static/js/16.04e27cc2.chunk.js","sourcesContent":["import axios from \"../../axios\";\r\nimport socketIOClient from 'socket.io-client';\r\nimport {\r\n  CHANGE_CHAT_NAME,\r\n  CHAT_LOADING,\r\n  CHAT_MESSAGES_ERROR,\r\n  CREATE_CHAT,\r\n  FETCH_CHAT_MESSAGES,\r\n  SEND_MESSAGE,\r\n  SEND_MESSAGE_ERROR,\r\n  UPDATE_LATEST_MESSAGE,\r\n} from \"./actionTypes\";\r\n\r\nexport const getChatMsgs = (chatId, currentPage, pageSize) => {\r\n  return async (dispatch, getState) => {\r\n    try {\r\n      if (currentPage === 1) {\r\n        dispatch({ type: CHAT_LOADING });\r\n      }\r\n      const token =\r\n        getState().user && getState().user.token\r\n          ? getState().user.token\r\n          : localStorage.getItem(\"accessToken\");\r\n      const { data } = await axios.get(`/chat/getMessages?chatId=${chatId}&currentPage=${currentPage}&pageSize=${pageSize}`, {\r\n        headers: {\r\n          Authorization: \"Bearer \" + token,\r\n        },\r\n      });\r\n      // console.log(data);\r\n      dispatch({\r\n        type: FETCH_CHAT_MESSAGES,\r\n        chat: data.chat,\r\n        messages: data.messages,\r\n        currentPage: data.currentPage,\r\n        pages: data.pages,\r\n        messagesCount: data.messagesCount,\r\n        pageSize: data.pageSize\r\n      });\r\n    } catch (err) {\r\n      dispatch({\r\n        type: CHAT_MESSAGES_ERROR,\r\n        error:\r\n          err.response && err.response.data && err.response.data.message\r\n            ? err.response.data.message\r\n            : err.message,\r\n      });\r\n    }\r\n  };\r\n};\r\n\r\nexport const createChat = (users, isGroupChat) => {\r\n  return async (dispatch, getState) => {\r\n    try {\r\n      dispatch({ type: CHAT_LOADING });\r\n      const { data } = await axios.post(\r\n        `/chat/createChat?isGroupChat=${isGroupChat}`,\r\n        { users },\r\n        {\r\n          headers: {\r\n            Authorization:\r\n              \"Bearer \" +\r\n              (getState().user.token || localStorage.getItem(\"accessToken\")),\r\n          },\r\n        }\r\n      );\r\n      const result = await dispatch({\r\n        type: CREATE_CHAT,\r\n        chat: data,\r\n      });\r\n      return result;\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n};\r\n\r\nexport const changeChatName = (chatId, chatName) => {\r\n  return async (dispatch, getState) => {\r\n    try {\r\n      await axios.put(\r\n        `/chat/changeChatName?chatId=${chatId}`,\r\n        { chatName },\r\n        {\r\n          headers: {\r\n            Authorization:\r\n              \"Bearer \" +\r\n              (getState().user.token || localStorage.getItem(\"accessToken\")),\r\n          },\r\n        }\r\n      );\r\n      dispatch({\r\n        type: CHANGE_CHAT_NAME,\r\n        chatName: chatName,\r\n      });\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n};\r\n\r\nexport const sendMessage = (chatId, content) => {\r\n  return async (dispatch, getState) => {\r\n    const newDate = new Date().toISOString();\r\n    dispatch({\r\n      type: SEND_MESSAGE,\r\n      message: {\r\n        content: content,\r\n        _id: newDate,\r\n        createdAt: new Date(),\r\n        updatedAt: new Date(),\r\n        sender: {\r\n          coverPhoto: getState().user.userDetails.coverPhoto,\r\n          firstName: getState().user.userDetails.firstName,\r\n          lastName: getState().user.userDetails.lastName,\r\n          profilePic: getState().user.userDetails.profilePic,\r\n          username: getState().user.userDetails.username,\r\n        },\r\n        readBy: [],\r\n        chat: chatId,\r\n        error: false\r\n      },\r\n    });\r\n    const SOCKETENDPOINT = process.env.NODE_ENV === 'development' ? 'http://localhost:8080': '/';\r\n    const socket = socketIOClient(SOCKETENDPOINT, {transports: ['websocket']});\r\n    socket.emit('sendMessage', {\r\n      sender: {\r\n        firstName: getState().user.userDetails.firstName,\r\n        lastName: getState().user.userDetails.lastName,\r\n        profilePic: getState().user.userDetails.profilePic,\r\n        username: getState().user.userDetails.username,\r\n        email: getState().user.userDetails.email,\r\n      },\r\n      content: content,\r\n      chatId: chatId,\r\n      createdAt: new Date()\r\n    });\r\n    try {\r\n      await axios.post(\r\n        `/chat/sendMessage?chatId=${chatId}`,\r\n        { content },\r\n        {\r\n          headers: {\r\n            Authorization:\r\n              \"Bearer \" +\r\n              (getState().user.token || localStorage.getItem(\"accessToken\")),\r\n          },\r\n        }\r\n      );\r\n      dispatch({\r\n          type: UPDATE_LATEST_MESSAGE,\r\n          content: content,\r\n          user: {\r\n            coverPhoto: getState().user.userDetails.coverPhoto,\r\n            firstName: getState().user.userDetails.firstName,\r\n            lastName: getState().user.userDetails.lastName,\r\n            profilePic: getState().user.userDetails.profilePic,\r\n            username: getState().user.userDetails.username,\r\n          },\r\n          chatId: chatId\r\n      });\r\n    } catch (err) {\r\n        console.log(err);\r\n      dispatch({\r\n        type: SEND_MESSAGE_ERROR,\r\n        msgId: newDate,\r\n      });\r\n    }\r\n  };\r\n};\r\n","import React, { useState } from \"react\";\r\nimport \"./ChatNameModel.scss\";\r\n\r\nconst ChatNameModel = ({closeChatNameModel, changeChatname}) => {\r\n\r\n    const [inputVal, setInputVal] = useState('');\r\n\r\n  return (\r\n    <div className=\"backdrop\">\r\n      <div className=\"changeChatModal\">\r\n        <div className=\"titleP\">\r\n          <h3>Change The Chat Name</h3>\r\n          <i className=\"fa fa-times\" onClick={closeChatNameModel}></i>\r\n        </div>\r\n        <div className=\"changeChatInput\">\r\n          <input type=\"text\" name=\"chatname\" value={inputVal} onChange={e => setInputVal(e.target.value)} />\r\n        </div>\r\n        <div className=\"btnActions\">\r\n          <button\r\n            className=\"btn btn-primary\"\r\n            onClick={() => changeChatname(inputVal)}\r\n          >\r\n            Save\r\n          </button>\r\n          <button onClick={closeChatNameModel} className=\"btn btn-danger\">\r\n            Cancel\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatNameModel;\r\n","import React, { useEffect, useRef, useState } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { Link, useLocation } from \"react-router-dom\";\r\nimport history from \"../../history\";\r\nimport { CLEAR_MESSAGES } from \"../../store/Actions/actionTypes\";\r\nimport { changeChatName, getChatMsgs, sendMessage } from \"../../store/Actions/chat\";\r\nimport Spinner from \"../Spinner/Spinner\";\r\nimport socketIOClient from \"socket.io-client\";\r\nimport ChatNameModel from \"./ChatNameModel/ChatNameModel\";\r\nimport \"./MessageChat.scss\";\r\n\r\nconst MessageChat = () => {\r\n  const location = useLocation();\r\n  const dispatch = useDispatch();\r\n  const { chatError, chatLoading, chat, messages, currentMessagesPage, totalMessagesPages } = useSelector((state) => state.chat);\r\n  const { userDetails } = useSelector((state) => state.user);\r\n  const [openModel, setOpenModel] = useState(false);\r\n\r\n  const titleRef = useRef();\r\n  const peoplesRef = useRef();\r\n  const formRef = useRef();\r\n  const messageChatRef = useRef();\r\n\r\n  const socket = useRef();\r\n\r\n  const SOCKETENDPOINT = process.env.NODE_ENV === 'development' ? 'http://localhost:8080': '/';\r\n\r\n  const { handleSubmit, register, reset } = useForm();\r\n\r\n  const sendMsg = formData => {\r\n    const content = formData.msg;\r\n    reset();\r\n    const list = document.getElementById(\"sc\");\r\n    dispatch(sendMessage(location.pathname.split(\"/\")[2], content)).then(() => {\r\n      list.scrollTop = list.scrollHeight - list.clientHeight - 1;\r\n    });\r\n  };\r\n\r\n  const openChatNameModel = () => {\r\n    setOpenModel(true);\r\n  };\r\n  const closeChatNameModel = () => {\r\n    setOpenModel(false);\r\n  };\r\n\r\n  const renderImageAndNames = () => {\r\n    if (chat) {\r\n      const chatUsers = chat.users.filter(\r\n        (user) => user.username !== localStorage.getItem(\"userName\")\r\n      );\r\n      const groupChatNames = chatUsers.map(\r\n        (user) => user.firstName + \" \" + user.lastName\r\n      );\r\n      if (chat.isGroupChat && chatUsers[1]) {\r\n        return (\r\n          <>\r\n            <div className=\"images\">\r\n              <img\r\n                className=\"firstImg\"\r\n                src={chatUsers[0].profilePic}\r\n                alt={chatUsers[0].username}\r\n              />\r\n              <img\r\n                className=\"secondImg\"\r\n                src={chatUsers[1].profilePic}\r\n                alt={chatUsers[1].username}\r\n              />\r\n              {chatUsers.length > 2 && <span className=\"usersLeft\">+{chatUsers.length - 2}</span>}\r\n            </div>\r\n            <span className=\"chatname\" onClick={openChatNameModel}>{chat.chatName ? chat.chatName: groupChatNames.join(\", \")}</span>\r\n          </>\r\n        );\r\n      } else {\r\n        return (\r\n          <>\r\n            <div className=\"image\">\r\n              <img\r\n                className=\"singleImg\"\r\n                src={chatUsers[0].profilePic}\r\n                alt={chatUsers[0].username}\r\n              />\r\n            </div>\r\n            <span className=\"chatname\">\r\n              {chatUsers[0].firstName + \" \" + chatUsers[0].lastName}\r\n            </span>\r\n          </>\r\n        );\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const pathname = location.pathname.split(\"/\")[2];\r\n    if (!pathname) {\r\n      history.push(\"/messages\");\r\n    } else {\r\n      socket.current = socketIOClient(SOCKETENDPOINT, {transports: ['websocket']});\r\n\r\n      socket.current.emit('join room', pathname);\r\n\r\n      dispatch(getChatMsgs(pathname, 1, 30)).then(() => {\r\n\r\n        if (titleRef.current && peoplesRef.current && formRef.current) {\r\n          const allElementsHeightAdded = titleRef.current.getBoundingClientRect().height + peoplesRef.current.getBoundingClientRect().height + formRef.current.getBoundingClientRect().height + 26;\r\n          document.querySelector('.messages').style.maxHeight = `calc(100vh - ${allElementsHeightAdded}px)`;\r\n          var list = document.getElementById(\"sc\");\r\n          list.scrollTop = list.scrollHeight - list.clientHeight - 1;\r\n        }\r\n      });\r\n    }\r\n    return () => {\r\n      dispatch({type: CLEAR_MESSAGES});\r\n      socket.current.disconnect();\r\n    }\r\n  }, [location.pathname, dispatch]);\r\n\r\n  const changeChatname = val => {\r\n    closeChatNameModel();\r\n    dispatch(changeChatName(location.pathname.split(\"/\")[2], val));\r\n  };\r\n\r\n  const renderOwnMsg = (content, error) => {\r\n    return (\r\n      <div className=\"flCol\">\r\n      <span style={{\r\n        opacity: error ? '.4': '1'\r\n      }}>{content}</span>\r\n      {error && <p className=\"error\">Error Sending this message</p>}\r\n      </div>\r\n    )\r\n  };\r\n\r\n  const renderTheirsMsg = (profilePic, firstName, lastName, username, content, isFirst, isLast) => {\r\n    return (\r\n      <div className=\"fl\" style={{marginTop: isFirst ? '12px': '0'}}>\r\n        <div className=\"image\">\r\n          {isLast && <img src={profilePic} alt={username} />}\r\n        </div>\r\n        <div className=\"content-names\">\r\n          {isFirst && <span className=\"firstlastnames\">{firstName} {lastName}</span>}\r\n          <span className=\"content\">{content}</span>\r\n        </div>\r\n      </div>\r\n    )\r\n  };\r\n\r\n  const renderMessages = () => {\r\n    return messages.map((msg, index) => {\r\n      const username = userDetails ? userDetails.username: localStorage.getItem('userName');\r\n      const isFirst = !messages[index - 1] || messages[index - 1].sender.username !== messages[index].sender.username;\r\n      const isLast = !messages[index + 1] || !messages[index - 1] || (messages[index - 1].sender.username === messages[index].sender.username && messages[index + 1].sender.username !== messages[index].sender.username);\r\n      const senderClassName = msg.sender.username === username ? 'own': 'theirs';\r\n      return (\r\n        <div className={`msg${index} ${senderClassName}`} key={msg._id}>\r\n          {senderClassName === 'own' ? renderOwnMsg(msg.content, msg.error): renderTheirsMsg(msg.sender.profilePic, msg.sender.firstName, msg.sender.lastName, msg.sender.username, msg.content, isFirst, isLast)}\r\n        </div>\r\n      )\r\n    });\r\n  };\r\n\r\n  const msgsScroll = () => {\r\n      var list = document.getElementById(\"sc\");\r\n      if (list.scrollTop === 0 && currentMessagesPage + 1 <= totalMessagesPages) {\r\n        dispatch(getChatMsgs(location.pathname.split(\"/\")[2], currentMessagesPage + 1, 30)).then(() => {\r\n          list.scrollTop = (list.scrollHeight - list.clientHeight) / 2\r\n        });\r\n      }\r\n  };\r\n\r\n  console.log('CHAT RENDERED')\r\n\r\n  return (\r\n    <>\r\n    <div className=\"messagechat\">\r\n      <div className=\"title\" ref={titleRef}>\r\n        <h2>Chat</h2>\r\n        <Link to=\"/messages/new\">\r\n          <i className=\"far fa-plus-square\"></i>\r\n        </Link>\r\n      </div>\r\n      {chat && <div className=\"peoplesChat\" ref={peoplesRef}>{renderImageAndNames()}</div>}\r\n      <div className=\"messages\" ref={messageChatRef} id=\"sc\" onScroll={msgsScroll}>\r\n        {chatLoading ? (\r\n          <Spinner width=\"60px\" />\r\n        ) : chatError ? (\r\n          <h4 className=\"chaterror\">{chatError}</h4>\r\n        ) : renderMessages()}\r\n      </div>\r\n      <form className=\"submitMsg\" ref={formRef} onSubmit={handleSubmit(sendMsg)}>\r\n        <input type=\"text\" name=\"msg\" placeholder=\"Type a message...\" ref={register({ required: true })} />\r\n        <button type=\"submit\">\r\n          <i className=\"fas fa-paper-plane\"></i>\r\n        </button>\r\n      </form>\r\n    </div>\r\n    {openModel && <ChatNameModel closeChatNameModel={closeChatNameModel} changeChatname={changeChatname} />}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MessageChat;\r\n"],"sourceRoot":""}