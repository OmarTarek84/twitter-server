(this["webpackJsonptwitter-clone"]=this["webpackJsonptwitter-clone"]||[]).push([[18],{171:function(e,t,s){},193:function(e,t,s){"use strict";s.r(t);var o=s(2),a=s(32),r=s.n(a),n=s(43),i=s(143),c=s(3),l=s(0),p=s(1),u=s(21),d=s(145),m=s(152),g=s(44),f=(s(171),s(45)),b=s(8),j=s(144),y=s(33),D=s(46),O=function(e,t){var s=6e4,o=36e5,a=864e5,r=2592e6,n=31536e6,i=e-t;return i<s?i/1e3<30?"Just Now":Math.round(i/1e3)+" seconds ago":i<o?Math.round(i/s)+" minutes ago":i<a?Math.round(i/o)+" hours ago":i<r?Math.round(i/a)+" days ago":i<n?Math.round(i/r)+" months ago":Math.round(i/n)+" years ago"},h={postLoading:!1,postDetails:null,postErrorMessage:null,postLoaded:!1},I=function(e,t){switch(t.type){case"fetch_post":return Object(l.a)(Object(l.a)({},e),{},{postDetails:t.post,postErrorMessage:null,postLoading:!1,postLoaded:!0});case"post_loading":return Object(l.a)(Object(l.a)({},e),{},{postLoading:!0});case"post_error":return Object(l.a)(Object(l.a)({},e),{},{postErrorMessage:t.error,postLoading:!1});case"add_reply":return Object(l.a)(Object(l.a)({},e),{},{postLoading:!1,postDetails:Object(l.a)(Object(l.a)({},e.postDetails),{},{replies:[].concat(Object(c.a)(e.postDetails.replies),[t.reply])})});case"retweet":var s=Object(c.a)(e.postDetails.retweetUsers);return s.findIndex((function(e){return e.username===localStorage.getItem("userName")}))>-1?s=s.filter((function(e){return e.username!==localStorage.getItem("userName")})):s.unshift({firstName:localStorage.getItem("firstName"),lastName:localStorage.getItem("lastName"),username:localStorage.getItem("userName"),profilePic:localStorage.getItem("profilePic")}),Object(l.a)(Object(l.a)({},e),{},{postDetails:Object(l.a)(Object(l.a)({},e.postDetails),{},{retweetUsers:s})});case"like_post":var o=Object(c.a)(e.postDetails.likes);if(t.postId===e.postDetails._id){var a=o.findIndex((function(e){return e.username===localStorage.getItem("userName")}));a>-1?o.splice(a,1):o.push({firstName:localStorage.getItem("firstName"),lastName:localStorage.getItem("lastName"),username:localStorage.getItem("userName"),profilePic:localStorage.getItem("profilePic")})}else{var r=e.postDetails.replies.find((function(e){return e._id===t.postId}));if(console.log(r),r){var n=r.likes.findIndex((function(e){return e.username===localStorage.getItem("userName")}));n>-1?r.likes.splice(n,1):r.likes.push({firstName:localStorage.getItem("firstName"),lastName:localStorage.getItem("lastName"),profilePic:localStorage.getItem("profilePic"),username:localStorage.getItem("userName")})}}return Object(l.a)(Object(l.a)({},e),{},{postDetails:Object(l.a)(Object(l.a)({},e.postDetails),{},{likes:Object(c.a)(o)})});case"delete_reply_post":var i=Object(c.a)(e.postDetails.replies),p=i.findIndex((function(e){return e._id===t.replyPostId}));return i.splice(p,1),Object(l.a)(Object(l.a)({},e),{},{postDetails:Object(l.a)(Object(l.a)({},e.postDetails),{},{replies:Object(c.a)(i)})});default:return e}};t.default=function(e){var t=Object(u.b)(),s=Object(p.useReducer)(I,h),a=Object(i.a)(s,2),c=a[0],l=a[1],P=Object(u.c)((function(e){return e.user})).userDetails,w=Object(u.c)((function(e){return e.post})),N=w.postActionLoading,S=w.retweetActionLoading,_=w.posts,k=Object(D.a)().socket,v=Object(p.useRef)(),R=Object(p.useRef)(),T=Object(p.useRef)(),x=Object(p.useRef)(),B=function(e,s,o){t(Object(d.d)(e,s)),o!==P.username&&k.current.emit("notification Sent",{notificationFrom:P.username,notificationTo:[o],type:"like",postId:e}),_.length<=0&&l({type:"like_post",postId:e})},L=function(){var e=Object(n.a)(r.a.mark((function e(s,o,a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T.current=y.b.warning("Submitting Your Reply..."),e.next=3,t(Object(d.e)(s.reply,o));case 3:n=e.sent,y.b.dismiss(T.current),y.b.success("Reply Post Success"),k.current.emit("notification Sent",{notificationFrom:P.username,notificationTo:[a],type:"reply",postId:o}),l({type:"add_reply",reply:n.post});case 8:case"end":return e.stop()}}),e)})));return function(t,s,o){return e.apply(this,arguments)}}(),A=function(e,s){v.current=y.b.warning("Deleting Your Post..."),l({type:"delete_reply_post",replyPostId:e}),t(Object(d.b)(e,s)).then((function(){y.b.dismiss(v.current),y.b.success("Delete Post Success")}))},U=function(e){R.current=y.b.warning("Pinning Post..."),t(Object(j.b)(e)).then((function(){y.b.dismiss(R.current),y.b.success("Pin Post Success")}))},M=function(e,s,o){_.length<=0&&l({type:"retweet",postId:e}),x.current=y.b.warning("Submitting Your retweet..."),t(Object(d.f)(e,s)).then((function(){y.b.dismiss(x.current),y.b.success("Retweet Success"),o!==P.username&&k.current.emit("notification Sent",{notificationFrom:P.username,notificationTo:[o],type:"retweet",postId:e})}))},E=function(e,s){l({type:"post_loading"}),t(Object(d.b)(e,s)).then((function(){b.a.push("/")}))},q=function(e){b.a.push("/profile/".concat(e))};Object(p.useEffect)((function(){if(_&&!(_.length<=0)&&b.a.location.state&&b.a.location.state.postId||c.postLoaded){if(_.length>0&&b.a.location.state&&b.a.location.state.postId){var t=_.find((function(e){return e._id===b.a.location.state.postId}));l({type:"fetch_post",post:t})}}else l({type:"post_loading"}),function(){var t=Object(n.a)(r.a.mark((function t(){var s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,g.a.get("/post/".concat(e.match.params.postId),{headers:{Authorization:"Bearer "+localStorage.getItem("accessToken")}});case 3:s=t.sent,console.log("responsedata",s.data),l({type:"fetch_post",post:s.data}),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0),l({type:"post_error",error:t.t0.response&&t.t0.response.data&&t.t0.response.data.message?t.t0.response.data.message:t.t0.message});case 12:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}}()()}),[e.match.params.postId,_,c.postLoaded]);var F=c.postDetails&&c.postDetails.replies.map((function(e){return Object(o.jsx)(m.a,{postId:e._id,firstName:e.postedBy.firstName,lastName:e.postedBy.lastName,username:e.postedBy.username,content:e.content,createdAt:O(new Date,new Date(e.content?e.createdAt:e.retweetData.createdAt)),goToProfile:q,profilePic:e.postedBy.profilePic,likePostReq:B,replyTo:e.replyTo||null,likes:e.likes,deletePost:A,postActionLoading:N,loggedInUsername:P?P.username:localStorage.getItem("userName"),retweetReq:M,retweetActionLoading:S,retweetUsers:e.retweetUsers||[],retweetData:e.retweetData,submitReplyReq:L,pinPost:function(){return U(e._id)},pinnedPostId:P&&P.pinnedPost?P.pinnedPost._id:null,disableBorderBottom:!0,replyToUsername:e.replyTo&&e.replyTo.originalPost?e.replyTo.originalPost.postedBy.username:null,type:"replyPost",replyPostTypeReplyToUsername:c.postDetails.postedBy.username,postIdHasGreenBackground:b.a.location.state?b.a.location.state.backgroundGreenPostId:null},e._id)}));console.log("VIEWPOST RENDERED");return Object(o.jsxs)("div",{className:"viewpost",children:[Object(o.jsx)("h1",{children:"View Post"}),c.postErrorMessage?Object(o.jsx)("p",{className:"error",children:c.postErrorMessage}):c&&!c.postLoading&&c.postDetails?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(m.a,{postId:c.postDetails._id,firstName:c.postDetails.postedBy.firstName,lastName:c.postDetails.postedBy.lastName,username:c.postDetails.postedBy.username,content:c.postDetails.content,createdAt:O(new Date,new Date(c.postDetails.content?c.postDetails.createdAt:c.postDetails.retweetData.createdAt)),profilePic:c.postDetails.postedBy.profilePic,likePostReq:B,likes:c.postDetails.likes,postActionLoading:N,loggedInUsername:P?P.username:localStorage.getItem("userName"),goToProfile:q,retweetReq:M,retweetActionLoading:S,retweetUsers:c.postDetails.retweetUsers,retweetData:c.postDetails.retweetData,submitReplyReq:L,replyToUsername:c.postDetails.replyTo&&c.postDetails.replyTo.originalPost?c.postDetails.replyTo.originalPost.postedBy.username:null,replyPostTypeReplyToUsername:c.postDetails.postedBy.username,deletePost:E,pinnedPost:!1,pinnedPostId:P&&P.pinnedPost?P.pinnedPost._id:null,pinPost:function(){return U(c.postDetails._id)}}),c.postDetails.replies&&c.postDetails.replies.length>0&&Object(o.jsx)("h5",{children:"Replies:"}),c.postDetails.replies&&c.postDetails.replies.length>0&&F]}):Object(o.jsx)(f.a,{width:"80"})]})}}}]);
//# sourceMappingURL=18.655036c2.chunk.js.map