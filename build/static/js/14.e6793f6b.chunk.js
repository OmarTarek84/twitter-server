(this["webpackJsonptwitter-clone"]=this["webpackJsonptwitter-clone"]||[]).push([[14],{110:function(e,t,s){},124:function(e,t,s){"use strict";s.r(t);var a=s(2),o=s(21),r=s.n(o),n=s(27),i=s(83),l=s(4),c=s(1),p=s(0),u=s(16),d=s(85),g=s(87),m=s(29),f=(s(110),s(28)),b=s(12),j=s(84),y=s(30),D=function(e,t){var s=6e4,a=36e5,o=864e5,r=2592e6,n=31536e6,i=e-t;return i<s?i/1e3<30?"Just Now":Math.round(i/1e3)+" seconds ago":i<a?Math.round(i/s)+" minutes ago":i<o?Math.round(i/a)+" hours ago":i<r?Math.round(i/o)+" days ago":i<n?Math.round(i/r)+" months ago":Math.round(i/n)+" years ago"},O={postLoading:!1,postDetails:null,postErrorMessage:null,postLoaded:!1},h=function(e,t){switch(t.type){case"fetch_post":return Object(c.a)(Object(c.a)({},e),{},{postDetails:t.post,postErrorMessage:null,postLoading:!1,postLoaded:!0});case"post_loading":return Object(c.a)(Object(c.a)({},e),{},{postLoading:!0});case"post_error":return Object(c.a)(Object(c.a)({},e),{},{postErrorMessage:t.error,postLoading:!1});case"add_reply":return Object(c.a)(Object(c.a)({},e),{},{postLoading:!1,postDetails:Object(c.a)(Object(c.a)({},e.postDetails),{},{replies:[].concat(Object(l.a)(e.postDetails.replies),[t.reply])})});case"retweet":var s=Object(l.a)(e.postDetails.retweetUsers);return s.findIndex((function(e){return e.username===localStorage.getItem("userName")}))>-1?s=s.filter((function(e){return e.username!==localStorage.getItem("userName")})):s.unshift({firstName:localStorage.getItem("firstName"),lastName:localStorage.getItem("lastName"),username:localStorage.getItem("userName"),profilePic:localStorage.getItem("profilePic")}),Object(c.a)(Object(c.a)({},e),{},{postDetails:Object(c.a)(Object(c.a)({},e.postDetails),{},{retweetUsers:s})});case"like_post":var a=Object(l.a)(e.postDetails.likes);if(t.postId===e.postDetails._id){var o=a.findIndex((function(e){return e.username===localStorage.getItem("userName")}));o>-1?a.splice(o,1):a.push({firstName:localStorage.getItem("firstName"),lastName:localStorage.getItem("lastName"),username:localStorage.getItem("userName"),profilePic:localStorage.getItem("profilePic")})}else{var r=e.postDetails.replies.find((function(e){return e._id===t.postId}));if(console.log(r),r){var n=r.likes.findIndex((function(e){return e.username===localStorage.getItem("userName")}));n>-1?r.likes.splice(n,1):r.likes.push({firstName:localStorage.getItem("firstName"),lastName:localStorage.getItem("lastName"),profilePic:localStorage.getItem("profilePic"),username:localStorage.getItem("userName")})}}return Object(c.a)(Object(c.a)({},e),{},{postDetails:Object(c.a)(Object(c.a)({},e.postDetails),{},{likes:Object(l.a)(a)})});case"delete_reply_post":var i=Object(l.a)(e.postDetails.replies),p=i.findIndex((function(e){return e._id===t.replyPostId}));return i.splice(p,1),Object(c.a)(Object(c.a)({},e),{},{postDetails:Object(c.a)(Object(c.a)({},e.postDetails),{},{replies:Object(l.a)(i)})});default:return e}};t.default=function(e){var t=Object(u.b)(),s=Object(p.useReducer)(h,O),o=Object(i.a)(s,2),l=o[0],c=o[1],P=Object(u.c)((function(e){return e.user})).userDetails,w=Object(u.c)((function(e){return e.post})),I=w.postActionLoading,N=w.retweetActionLoading,_=w.posts,S=Object(p.useRef)(),k=Object(p.useRef)(),v=Object(p.useRef)(),R=Object(p.useRef)(),T=function(e,s){t(Object(d.d)(e,s)),_.length<=0&&c({type:"like_post",postId:e})},x=function(){var e=Object(n.a)(r.a.mark((function e(s,a){var o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.current=y.b.warning("Submitting Your Reply..."),e.next=3,t(Object(d.e)(s.reply,a));case 3:o=e.sent,y.b.dismiss(v.current),y.b.success("Reply Post Success"),c({type:"add_reply",reply:o.post});case 7:case"end":return e.stop()}}),e)})));return function(t,s){return e.apply(this,arguments)}}(),B=function(e,s){S.current=y.b.warning("Deleting Your Post..."),c({type:"delete_reply_post",replyPostId:e}),t(Object(d.b)(e,s)).then((function(){y.b.dismiss(S.current),y.b.success("Delete Post Success")}))},L=function(e){k.current=y.b.warning("Pinning Post..."),t(Object(j.b)(e)).then((function(){y.b.dismiss(k.current),y.b.success("Pin Post Success")}))},A=function(e,s){_.length<=0&&c({type:"retweet",postId:e}),R.current=y.b.warning("Submitting Your retweet..."),t(Object(d.f)(e,s)).then((function(){y.b.dismiss(R.current),y.b.success("Retweet Success")}))},U=function(e,s){c({type:"post_loading"}),t(Object(d.b)(e,s)).then((function(){b.a.push("/")}))},M=function(e){b.a.push("/profile/".concat(e))};Object(p.useEffect)((function(){if(_&&!(_.length<=0)||l.postLoaded){if(_.length>0&&b.a.location.state&&b.a.location.state.postId){var t=_.find((function(e){return e._id===b.a.location.state.postId}));c({type:"fetch_post",post:t})}}else c({type:"post_loading"}),function(){var t=Object(n.a)(r.a.mark((function t(){var s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,m.a.get("/post/".concat(e.match.params.postId),{headers:{Authorization:"Bearer "+localStorage.getItem("accessToken")}});case 3:s=t.sent,console.log("responsedata",s.data),c({type:"fetch_post",post:s.data}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),c({type:"post_error",error:t.t0.response&&t.t0.response.data&&t.t0.response.data.message?t.t0.response.data.message:t.t0.message});case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}}()()}),[e.match.params.postId,_,l.postLoaded]);var E=l.postDetails&&l.postDetails.replies.map((function(e){return Object(a.jsx)(g.a,{postId:e._id,firstName:e.postedBy.firstName,lastName:e.postedBy.lastName,username:e.postedBy.username,content:e.content,createdAt:D(new Date,new Date(e.content?e.createdAt:e.retweetData.createdAt)),goToProfile:M,profilePic:e.postedBy.profilePic,likePostReq:T,replyTo:e.replyTo||null,likes:e.likes,deletePost:B,postActionLoading:I,loggedInUsername:P?P.username:localStorage.getItem("userName"),retweetReq:A,retweetActionLoading:N,retweetUsers:e.retweetUsers||[],retweetData:e.retweetData,submitReplyReq:x,pinPost:function(){return L(e._id)},pinnedPostId:P&&P.pinnedPost?P.pinnedPost._id:null,disableBorderBottom:!0,replyToUsername:e.replyTo&&e.replyTo.originalPost?e.replyTo.originalPost.postedBy.username:null,type:"replyPost",replyPostTypeReplyToUsername:l.postDetails.postedBy.username,postIdHasGreenBackground:b.a.location.state?b.a.location.state.backgroundGreenPostId:null},e._id)}));console.log("VIEWPOST RENDERED");return Object(a.jsxs)("div",{className:"viewpost",children:[Object(a.jsx)("h1",{children:"View Post"}),l.postErrorMessage?Object(a.jsx)("p",{className:"error",children:l.postErrorMessage}):l&&!l.postLoading&&l.postDetails?Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(g.a,{postId:l.postDetails._id,firstName:l.postDetails.postedBy.firstName,lastName:l.postDetails.postedBy.lastName,username:l.postDetails.postedBy.username,content:l.postDetails.content,createdAt:D(new Date,new Date(l.postDetails.content?l.postDetails.createdAt:l.postDetails.retweetData.createdAt)),profilePic:l.postDetails.postedBy.profilePic,likePostReq:T,likes:l.postDetails.likes,postActionLoading:I,loggedInUsername:P.username||localStorage.getItem("userName"),goToProfile:M,retweetReq:A,retweetActionLoading:N,retweetUsers:l.postDetails.retweetUsers,retweetData:l.postDetails.retweetData,submitReplyReq:x,replyToUsername:l.postDetails.replyTo&&l.postDetails.replyTo.originalPost?l.postDetails.replyTo.originalPost.postedBy.username:null,replyPostTypeReplyToUsername:l.postDetails.postedBy.username,deletePost:U,pinnedPost:!1,pinnedPostId:P&&P.pinnedPost?P.pinnedPost._id:null,pinPost:function(){return L(l.postDetails._id)}}),l.postDetails.replies&&l.postDetails.replies.length>0&&Object(a.jsx)("h5",{children:"Replies:"}),l.postDetails.replies&&l.postDetails.replies.length>0&&E]}):Object(a.jsx)(f.a,{width:"80"})]})}}}]);
//# sourceMappingURL=14.e6793f6b.chunk.js.map