(this["webpackJsonptwitter-clone"]=this["webpackJsonptwitter-clone"]||[]).push([[17],{146:function(e,t,s){"use strict";s.d(t,"c",(function(){return l})),s.d(t,"b",(function(){return m})),s.d(t,"a",(function(){return h})),s.d(t,"d",(function(){return d}));var a=s(32),r=s.n(a),n=s(42),c=s(43),i=s(29),u=s.n(i),o=s(6),l=function(e,t,s){return function(){var a=Object(n.a)(r.a.mark((function a(n,i){var u,l,m;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,1===t&&n({type:o.CHAT_LOADING}),u=i().user&&i().user.token?i().user.token:localStorage.getItem("accessToken"),a.next=5,c.a.get("/chat/getMessages?chatId=".concat(e,"&currentPage=").concat(t,"&pageSize=").concat(s),{headers:{Authorization:"Bearer "+u}});case 5:l=a.sent,m=l.data,n({type:o.FETCH_CHAT_MESSAGES,chat:m.chat,messages:m.messages,currentPage:m.currentPage,pages:m.pages,messagesCount:m.messagesCount,pageSize:m.pageSize}),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(0),n({type:o.CHAT_MESSAGES_ERROR,error:a.t0.response&&a.t0.response.data&&a.t0.response.data.message?a.t0.response.data.message:a.t0.message});case 13:case"end":return a.stop()}}),a,null,[[0,10]])})));return function(e,t){return a.apply(this,arguments)}}()},m=function(e,t){return function(){var s=Object(n.a)(r.a.mark((function s(a,n){var i,u,l;return r.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,a({type:o.CHAT_LOADING}),s.next=4,c.a.post("/chat/createChat?isGroupChat=".concat(t),{users:e},{headers:{Authorization:"Bearer "+(n().user.token||localStorage.getItem("accessToken"))}});case 4:return i=s.sent,u=i.data,s.next=8,a({type:o.CREATE_CHAT,chat:u});case 8:return l=s.sent,s.abrupt("return",l);case 12:s.prev=12,s.t0=s.catch(0),console.log(s.t0);case 15:case"end":return s.stop()}}),s,null,[[0,12]])})));return function(e,t){return s.apply(this,arguments)}}()},h=function(e,t){return function(){var s=Object(n.a)(r.a.mark((function s(a,n){return r.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,c.a.put("/chat/changeChatName?chatId=".concat(e),{chatName:t},{headers:{Authorization:"Bearer "+(n().user.token||localStorage.getItem("accessToken"))}});case 3:a({type:o.CHANGE_CHAT_NAME,chatName:t}),s.next=9;break;case 6:s.prev=6,s.t0=s.catch(0),console.log(s.t0);case 9:case"end":return s.stop()}}),s,null,[[0,6]])})));return function(e,t){return s.apply(this,arguments)}}()},d=function(e,t){return function(){var s=Object(n.a)(r.a.mark((function s(a,n){var i;return r.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return i=(new Date).toISOString(),a({type:o.SEND_MESSAGE,message:{content:t,_id:i,createdAt:new Date,updatedAt:new Date,sender:{coverPhoto:n().user.userDetails.coverPhoto,firstName:n().user.userDetails.firstName,lastName:n().user.userDetails.lastName,profilePic:n().user.userDetails.profilePic,username:n().user.userDetails.username},readBy:[],chat:e,error:!1}}),"/",u()("/",{transports:["websocket"]}).emit("sendMessage",{sender:{firstName:n().user.userDetails.firstName,lastName:n().user.userDetails.lastName,profilePic:n().user.userDetails.profilePic,username:n().user.userDetails.username,email:n().user.userDetails.email},content:t,chatId:e,createdAt:new Date}),s.prev=5,s.next=8,c.a.post("/chat/sendMessage?chatId=".concat(e),{content:t},{headers:{Authorization:"Bearer "+(n().user.token||localStorage.getItem("accessToken"))}});case 8:a({type:o.UPDATE_LATEST_MESSAGE,content:t,user:{coverPhoto:n().user.userDetails.coverPhoto,firstName:n().user.userDetails.firstName,lastName:n().user.userDetails.lastName,profilePic:n().user.userDetails.profilePic,username:n().user.userDetails.username},chatId:e}),s.next=15;break;case 11:s.prev=11,s.t0=s.catch(5),console.log(s.t0),a({type:o.SEND_MESSAGE_ERROR,msgId:i});case 15:case"end":return s.stop()}}),s,null,[[5,11]])})));return function(e,t){return s.apply(this,arguments)}}()}},183:function(e,t,s){},184:function(e,t,s){},198:function(e,t,s){"use strict";s.r(t);var a=s(2),r=s(140),n=s(1),c=s(150),i=s(21),u=s(5),o=s(13),l=s(12),m=s(6),h=s(146),d=s(44),j=s(29),p=s.n(j),g=(s(183),function(e){var t=e.closeChatNameModel,s=e.changeChatname,c=Object(n.useState)(""),i=Object(r.a)(c,2),u=i[0],o=i[1];return Object(a.jsx)("div",{className:"backdrop",children:Object(a.jsxs)("div",{className:"changeChatModal",children:[Object(a.jsxs)("div",{className:"titleP",children:[Object(a.jsx)("h3",{children:"Change The Chat Name"}),Object(a.jsx)("i",{className:"fa fa-times",onClick:t})]}),Object(a.jsx)("div",{className:"changeChatInput",children:Object(a.jsx)("input",{type:"text",name:"chatname",value:u,onChange:function(e){return o(e.target.value)}})}),Object(a.jsxs)("div",{className:"btnActions",children:[Object(a.jsx)("button",{className:"btn btn-primary",onClick:function(){return s(u)},children:"Save"}),Object(a.jsx)("button",{onClick:t,className:"btn btn-danger",children:"Cancel"})]})]})})});s(184),t.default=function(){var e=Object(u.f)(),t=Object(i.b)(),s=Object(i.c)((function(e){return e.chat})),j=s.chatError,f=s.chatLoading,b=s.chat,O=s.messages,N=s.currentMessagesPage,x=s.totalMessagesPages,v=Object(i.c)((function(e){return e.user})).userDetails,C=Object(n.useState)(!1),S=Object(r.a)(C,2),E=S[0],A=S[1],y=Object(n.useRef)(),D=Object(n.useRef)(),k=Object(n.useRef)(),T=Object(n.useRef)(),w=Object(n.useRef)(),I=Object(c.a)(),P=I.handleSubmit,R=I.register,_=I.reset,H=function(){A(!0)},M=function(){A(!1)};Object(n.useEffect)((function(){var s=e.pathname.split("/")[2];return s?(w.current=p()("/",{transports:["websocket"]}),w.current.emit("join room",s),t(Object(h.c)(s,1,30)).then((function(){if(y.current&&D.current&&k.current){var e=y.current.getBoundingClientRect().height+D.current.getBoundingClientRect().height+k.current.getBoundingClientRect().height+26;document.querySelector(".messages").style.maxHeight="calc(100vh - ".concat(e,"px)");var t=document.getElementById("sc");t.scrollTop=t.scrollHeight-t.clientHeight-1}}))):l.a.push("/messages"),function(){t({type:m.CLEAR_MESSAGES}),w.current.disconnect()}}),[e.pathname,t]);var B=function(e,t,s,r,n,c,i){return Object(a.jsxs)("div",{className:"fl",style:{marginTop:c?"12px":"0"},children:[Object(a.jsx)("div",{className:"image",children:i&&Object(a.jsx)("img",{src:e,alt:r})}),Object(a.jsxs)("div",{className:"content-names",children:[c&&Object(a.jsxs)("span",{className:"firstlastnames",children:[t," ",s]}),Object(a.jsx)("span",{className:"content",children:n})]})]})};return console.log("CHAT RENDERED"),Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{className:"messagechat",children:[Object(a.jsxs)("div",{className:"title",ref:y,children:[Object(a.jsx)("h2",{children:"Chat"}),Object(a.jsx)(o.a,{to:"/messages/new",children:Object(a.jsx)("i",{className:"far fa-plus-square"})})]}),b&&Object(a.jsx)("div",{className:"peoplesChat",ref:D,children:function(){if(b){var e=b.users.filter((function(e){return e.username!==localStorage.getItem("userName")})),t=e.map((function(e){return e.firstName+" "+e.lastName}));return b.isGroupChat&&e[1]?Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{className:"images",children:[Object(a.jsx)("img",{className:"firstImg",src:e[0].profilePic,alt:e[0].username}),Object(a.jsx)("img",{className:"secondImg",src:e[1].profilePic,alt:e[1].username}),e.length>2&&Object(a.jsxs)("span",{className:"usersLeft",children:["+",e.length-2]})]}),Object(a.jsx)("span",{className:"chatname",onClick:H,children:b.chatName?b.chatName:t.join(", ")})]}):Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{className:"image",children:Object(a.jsx)("img",{className:"singleImg",src:e[0].profilePic,alt:e[0].username})}),Object(a.jsx)("span",{className:"chatname",children:e[0].firstName+" "+e[0].lastName})]})}}()}),Object(a.jsx)("div",{className:"messages",ref:T,id:"sc",onScroll:function(){var s=document.getElementById("sc");0===s.scrollTop&&N+1<=x&&t(Object(h.c)(e.pathname.split("/")[2],N+1,30)).then((function(){s.scrollTop=(s.scrollHeight-s.clientHeight)/2}))},children:f?Object(a.jsx)(d.a,{width:"60px"}):j?Object(a.jsx)("h4",{className:"chaterror",children:j}):O.map((function(e,t){var s,r,n=v?v.username:localStorage.getItem("userName"),c=!O[t-1]||O[t-1].sender.username!==O[t].sender.username,i=!O[t+1]||!O[t-1]||O[t-1].sender.username===O[t].sender.username&&O[t+1].sender.username!==O[t].sender.username,u=e.sender.username===n?"own":"theirs";return Object(a.jsx)("div",{className:"msg".concat(t," ").concat(u),children:"own"===u?(s=e.content,r=e.error,Object(a.jsxs)("div",{className:"flCol",children:[Object(a.jsx)("span",{style:{opacity:r?".4":"1"},children:s}),r&&Object(a.jsx)("p",{className:"error",children:"Error Sending this message"})]})):B(e.sender.profilePic,e.sender.firstName,e.sender.lastName,e.sender.username,e.content,c,i)},e._id)}))}),Object(a.jsxs)("form",{className:"submitMsg",ref:k,onSubmit:P((function(s){var a=s.msg;_();var r=document.getElementById("sc");t(Object(h.d)(e.pathname.split("/")[2],a)).then((function(){r.scrollTop=r.scrollHeight-r.clientHeight-1}))})),children:[Object(a.jsx)("input",{type:"text",name:"msg",placeholder:"Type a message...",ref:R({required:!0})}),Object(a.jsx)("button",{type:"submit",children:Object(a.jsx)("i",{className:"fas fa-paper-plane"})})]})]}),E&&Object(a.jsx)(g,{closeChatNameModel:M,changeChatname:function(s){M(),t(Object(h.a)(e.pathname.split("/")[2],s))}})]})}}}]);
//# sourceMappingURL=17.ae2b267f.chunk.js.map